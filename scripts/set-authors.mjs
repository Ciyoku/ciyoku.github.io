import { promises as fs } from 'node:fs';

const LIST_PATH = 'books/list.json';

const AUTHOR_BY_ID = Object.freeze({
    'الكافي': 'محمد بن يعقوب الكليني',
    'الإحتجاج': 'أحمد بن علي الطبرسي',
    'الأمالي-الصدوق': 'محمد بن علي بن بابويه القمي',
    'الأمالي-المفيد': 'محمد بن محمد بن النعمان (الشيخ المفيد)',
    'الأمالي-الطوسي': 'محمد بن الحسن الطوسي',
    'التمحيص': 'الحسن بن علي بن شعبة الحراني',
    'علل-الشرائع': 'محمد بن علي بن بابويه القمي',
    'قرب-الإسناد': 'عبد الله بن جعفر الحميري',
    'معاني-الأخبار': 'محمد بن علي بن بابويه القمي',
    'الاختصاص': 'محمد بن محمد بن النعمان (منسوب إليه)',
    'الاستبصار': 'محمد بن الحسن الطوسي',
    'الإعتقادات': 'محمد بن علي بن بابويه القمي',
    'التوحيد': 'محمد بن علي بن بابويه القمي',
    'الحاشية على أصول الكافي': 'محمد أمين الإسترآبادي',
    'الخصال': 'محمد بن علي بن بابويه القمي',
    'الدرر النجفية من الملتقطات اليوسفية': 'يوسف بن أحمد البحراني',
    'الغيبة': 'محمد بن الحسن الطوسي',
    'الفصول المهمة في أصول الأئمة': 'محمد بن الحسن الحر العاملي',
    'الفوائد الطوسية': 'محمد بن الحسن الحر العاملي',
    'النوادر': 'أحمد بن محمد بن عيسى الأشعري القمي',
    'تفسير القمي': 'علي بن إبراهيم القمي',
    'دلائل الإمامة': 'محمد بن جرير الطبري الإمامي',
    'شرح الرسالة الصلاتية': 'يوسف بن أحمد آل عصفور البحراني',
    'كشف الأسرار في شرح الاستبصار': 'نعمة الله الجزائري',
    'كمال الدين و تمام النعمة': 'محمد بن علي بن بابويه القمي',
    'من لا يحضره الفقيه': 'محمد بن علي بن بابويه القمي'
});

async function run() {
    const raw = await fs.readFile(LIST_PATH, 'utf8');
    const books = JSON.parse(raw);

    let updated = 0;
    books.forEach((book) => {
        const id = String(book?.id ?? '');
        const author = AUTHOR_BY_ID[id];
        if (!author) return;
        book.author = author;
        updated += 1;
    });

    await fs.writeFile(LIST_PATH, `${JSON.stringify(books, null, 4)}\n`, 'utf8');
    console.log(`Updated author fields for ${updated} books.`);
}

run().catch((error) => {
    console.error(`Failed to set author fields: ${error.message}`);
    process.exitCode = 1;
});
